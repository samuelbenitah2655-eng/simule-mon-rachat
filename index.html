<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Économisez jusqu'à 15 000 € sur votre assurance de prêt | Simulation gratuite</title>
    <meta name="description" content="Changez d'assurance de prêt immobilier gratuitement. Simulation en 60 secondes, économisez jusqu'à 15 000 €. 0 € à payer, démarches incluses." />
    <meta name="author" content="Assurance Prêt Expert" />

    <meta property="og:title" content="Économisez jusqu'à 15 000 € sur votre assurance de prêt" />
    <meta property="og:description" content="Simulation gratuite d'assurance de prêt en 60 secondes. Changement gratuit et sans engagement." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Custom Code Block -->
    <script>
function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
  return '';
}

function uuidv4() {
  return crypto.randomUUID ? crypto.randomUUID() : 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c=>{
    const r=Math.random()*16|0,v=c==='x'?r:(r&0x3|0x8);return v.toString(16);
  });
}

function hiddenInput(name, value) {
  const input = document.createElement('input');
  input.type = 'hidden';
  input.name = name;
  input.value = value || '';
  return input;
}

document.addEventListener("DOMContentLoaded", function() {
  const form = document.querySelector("form"); 
  if (!form) return;

  const evId = uuidv4();
  const fbp = getCookie('_fbp');
  const url = new URL(window.location.href);
  const fbclid = url.searchParams.get("fbclid");
  const fbc = getCookie('_fbc') || (fbclid ? `fb.1.${Math.floor(Date.now()/1000)}.${fbclid}` : '');

  // Ajout des champs techniques
  form.appendChild(hiddenInput("event_id", evId));
  form.appendChild(hiddenInput("fbp", fbp));
  form.appendChild(hiddenInput("fbc", fbc));
  form.appendChild(hiddenInput("page_url", window.location.href));
  form.appendChild(hiddenInput("user_agent", navigator.userAgent));

  form.addEventListener("submit", function(e) {
    // Tir Pixel Lead
    if (typeof fbq === "function") {
      fbq("track", "Lead", {}, { eventID: evId });
    }

    // Envoi des données au webhook Make
    const formData = new FormData(form);
    fetch("https://hook.eu2.make.com/xd9w1pqkq82w4pkqgnb0d9sq80i6dtam", {
      method: "POST",
      body: formData
    });
  });
});
    </script>
  </body>
</html>
